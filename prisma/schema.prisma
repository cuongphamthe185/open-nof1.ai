// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Metrics {
  id String @id @default(uuid())

  name  String
  model ModelType

  metrics Json[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Chat {
  id String @id @default(uuid())

  model      ModelType @default(Deepseek)
  chat       String    @default("<no chat>")
  reasoning  String
  userPrompt String
  tradings   Trading[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Trading {
  id String @id @default(uuid())

  symbol     Symbol
  opeartion  Opeartion
  leverage   Int?
  amount     Int?
  pricing    Int?
  stopLoss   Int?
  takeProfit Int?

  // Order execution tracking
  orderId          String?   // Binance order ID
  executedAt       DateTime? // When order was executed
  executedPrice    Float?    // Actual fill price
  executedAmount   Float?    // Actual fill amount
  fee              Float?    // Trading fee
  status           String    @default("PENDING") // PENDING | FILLED | FAILED
  errorMessage     String?   // Error message if failed

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Chat   Chat?   @relation(fields: [chatId], references: [id], onDelete: Cascade)
  chatId String?
}

enum Opeartion {
  Buy
  Sell
  Hold
}

enum Symbol {
  BTC
  ETH
  BNB
  SOL
  DOGE
}

enum ModelType {
  Deepseek
  DeepseekThinking
  Qwen
  Doubao
}

model SupportResistanceLevel {
  id                    String   @id @default(uuid())
  symbol                String   // 'BTC', 'BNB'
  timeframe             String   // '15m', '1h', '4h'
  
  // Support levels
  support1              Decimal  @db.Decimal(12, 2)
  support1Strength      Int      // 1-10
  support2              Decimal? @db.Decimal(12, 2)
  support2Strength      Int?
  
  // Resistance levels
  resistance1           Decimal  @db.Decimal(12, 2)
  resistance1Strength   Int      // 1-10
  resistance2           Decimal? @db.Decimal(12, 2)
  resistance2Strength   Int?
  
  // Metadata
  currentPrice          Decimal  @db.Decimal(12, 2)
  calculationMethod     String   @default("hybrid")
  calculatedAt          DateTime @default(now())
  validUntil            DateTime
  
  createdAt             DateTime @default(now())
  
  @@unique([symbol, timeframe, calculatedAt])
  @@index([symbol, timeframe])
  @@index([calculatedAt])
  @@index([validUntil])
  @@map("support_resistance_levels")
}
